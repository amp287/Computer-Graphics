<html>

<!-- This demonstrates simple application of physics to Three.js application. -->

<head>
<script src="libs/three.js"></script>
<script src="libs/keyboard.js"></script>
<!-- 1. add the javascript include -->
<script src="libs/physi.js"></script>
</head>

<body>

<script>
	var renderer;
	var scene;
	var camera;
	var spotLight;
	
	<!-- add objects in the scope so all methods can access -->
	var groundPlane;
	var ball;

	<!-- 2. Add the following two lines. -->
	Physijs.scripts.worker = 'libs/physijs_worker.js';
    Physijs.scripts.ammo = 'ammo.js';
	
	function init()
	{
		<!-- 3. Edit the scene creation -->
		scene = new Physijs.Scene();
		scene.setGravity(new THREE.Vector3( 0, 0, -30 ));

		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );
		camera.position.x = 0;
		camera.position.y = -100;
		camera.position.z = 250;
		camera.lookAt( scene.position );
		
		renderer = new THREE.WebGLRenderer();
		//						color     alpha
		renderer.setClearColor( 0x000000, 1.0 );
		renderer.setSize( window.innerWidth, window.innerHeight );
		renderer.shadowMapEnabled = true;

		addSpotLight();
		
		<!-- 4. Ground plane -->
		createGroundPlane();
	
		<!-- 5. Ball -->
		createBall();

		// Output to the stream
		document.body.appendChild( renderer.domElement );
		
		// Call render
		render();
	}
	
	function render()
	{
		<!-- 6. Physics simulation -->
		scene.simulate();
		
		// Request animation frame
		requestAnimationFrame( render );
		
		// Call render()
		renderer.render( scene, camera );
	}
	
	function addSpotLight()
	{
        spotLight = new THREE.SpotLight( 0xffffff );
        spotLight.position.set( 0, 0, 200 );
        spotLight.shadowCameraNear = 10;
        spotLight.shadowCameraFar = 100;
        spotLight.castShadow = true;
		spotLight.intensity = 3;
        scene.add(spotLight);
	}

	<!-- 4. Ground plane -->
	function createGroundPlane()
	{
		var planeTexture = THREE.ImageUtils.loadTexture('images/groundterrain.jpg');
		
		//                                                                                           friction restitution
		var planeMaterial = new Physijs.createMaterial(new THREE.MeshLambertMaterial({map:planeTexture}), .95, 1.3 );
		var planeGeometry = new THREE.PlaneGeometry( 200, 200, 6 );
		groundPlane = new Physijs.BoxMesh( planeGeometry, planeMaterial, 0 );
		groundPlane.name = "GroundPlane";
		
		scene.add( groundPlane );
	}

	<!-- 5. Create ball -->
	function createBall()
	{
		var ballGeometry = new THREE.SphereGeometry( 3 );
		
		//                                                                                     friction restitution
		var ballMaterial = Physijs.createMaterial( new THREE.MeshLambertMaterial({color:'white'}), .95, 1.3 );
		ball = new Physijs.SphereMesh( ballGeometry, ballMaterial );
		
		ball.position.x = 0;;
		ball.position.y = 0;
		ball.position.z = 80;
		
		ball.name = 'CannonBall';
		scene.add( ball );
	}

	window.onload = init;
</script>

</body>

</html>
